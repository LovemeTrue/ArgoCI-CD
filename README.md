# üöÄ Elma365 GitOps Platform with ArgoCD & Helm

–≠—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç **GitOps-–ø–ª–∞—Ç—Ñ–æ—Ä–º—É** –¥–ª—è –¥–µ–ø–ª–æ—è `elma365` –∏ `elma365-dbs` –≤ Kubernetes —á–µ—Ä–µ–∑ **ArgoCD + Helm**, —Å –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π —á–µ—Ä–µ–∑ Makefile.

---

## üß∞ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Helm-—á–∞—Ä—Ç–æ–≤ `elma365` –∏ `elma365-dbs`
- üîÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ ‚Äî —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è —á–∞—Ä—Ç–∞ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ
- üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å ArgoCD
- üßπ –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö Git-–≤–µ—Ç–æ–∫
- üõ† CI/CD —á–µ—Ä–µ–∑ GitHub Actions
- ‚òÅÔ∏è –ê—Ä–≥–æCD App of Apps + `sync-wave` + `depends-on`

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –æ–∫—Ä—É–∂–µ–Ω–∏—é

–ù–∞ –º–∞—à–∏–Ω–µ, –æ—Ç–∫—É–¥–∞ —Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä—É–µ—à—å –¥–µ–ø–ª–æ–π, —É—Å—Ç–∞–Ω–æ–≤–∏:

| –ü–∞–∫–µ—Ç       | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                            |
|-------------|----------------------------------------|
| `kubectl`   | –†–∞–±–æ—Ç–∞ —Å Kubernetes                    |
| `helm`      | –†–∞–±–æ—Ç–∞ —Å Helm-—á–∞—Ä—Ç–∞–º–∏                  |
| `make`      | –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ü–µ–ª–µ–π Makefile              |
| `yq`        | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ YAML (CLI)              |
| `git`       | –†–∞–±–æ—Ç–∞ —Å Git                           |
| `gh`        | GitHub CLI ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ Pull Request     |
| `argocd`    | CLI –¥–ª—è ArgoCD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)           |

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```
.
‚îú‚îÄ‚îÄ Makefile                     # –ì–ª–∞–≤–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º CI/CD
‚îú‚îÄ‚îÄ apps/                        # ArgoCD Application YAML-—Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ 2025.4.2/                    # –ü—Ä–∏–º–µ—Ä –≤–µ—Ä—Å–∏–∏ —á–∞—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ elma365/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ values-elma365.yaml
‚îÇ   ‚îî‚îÄ‚îÄ elma365-dbs/
‚îÇ       ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ       ‚îú‚îÄ‚îÄ values-elma365-dbs.yaml
‚îú‚îÄ‚îÄ ssl/                         # TLS-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –∏ –∫–æ—Ä–Ω–µ–≤–æ–π CA
‚îÇ   ‚îú‚îÄ‚îÄ kind.elewise.local.crt
‚îÇ   ‚îú‚îÄ‚îÄ kind.elewise.local.key
‚îÇ   ‚îî‚îÄ‚îÄ rootCA.pem
```
---

## üîß –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Makefile

| –ö–æ–º–∞–Ω–¥–∞                              | –ß—Ç–æ –¥–µ–ª–∞–µ—Ç                                                   |
|--------------------------------------|--------------------------------------------------------------|
| `make release VERSION=2025.4.3`      | –°–∫–∞—á–∏–≤–∞–µ—Ç —á–∞—Ä—Ç—ã elma365/elma365-dbs –∏ –∫–æ–ø–∏—Ä—É–µ—Ç values        |
| `make gen-apps VERSION=2025.4.3`     | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç YAML-—Ñ–∞–π–ª—ã ArgoCD Application                    |
| `make release-full VERSION=...`      | –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª: release ‚Üí cleanup ‚Üí gen-apps ‚Üí git push         |
| `make cleanup-old-apps`              | –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ `apps/elma365-*.yaml`, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏   |
| `make cleanup-local-branches`        | –£–¥–∞–ª—è–µ—Ç –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ Git-–≤–µ—Ç–∫–∏ –∫—Ä–æ–º–µ `main`                 |
| `make delete-old-applications`       | –£–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–µ ArgoCD Application –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞                |

---
üõ† Makefile Targets

üîÅ make release-full VERSION=2025.4.2

–ü–æ–ª–Ω—ã–π GitOps-—Ä–µ–ª–∏–∑:
	‚Ä¢	–°–∫–µ–π–ª–∏—Ç –∏ —É–¥–∞–ª—è–µ—Ç namespace elma365, elma365-dbs
	‚Ä¢	–£–¥–∞–ª—è–µ—Ç ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ finalizer‚Äô—ã
	‚Ä¢	–°–æ–∑–¥–∞—ë—Ç namespace‚Äô—ã –∑–∞–Ω–æ–≤–æ, –ø—Ä–∏–º–µ–Ω—è–µ—Ç label‚Äô—ã
	‚Ä¢	–°–æ–∑–¥–∞—ë—Ç TLS-—Å–µ–∫—Ä–µ—Ç—ã –∏ ConfigMap —Å CA
	‚Ä¢	–°–∫–∞—á–∏–≤–∞–µ—Ç –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é —á–∞—Ä—Ç–∞
	‚Ä¢	–ö–æ–ø–∏—Ä—É–µ—Ç values-—Ñ–∞–π–ª—ã
	‚Ä¢	–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç ArgoCD Application YAML
	‚Ä¢	–û–±–Ω–æ–≤–ª—è–µ—Ç root-app —á–µ—Ä–µ–∑ hard-refresh

üßº make clean-argocd

–ß–∏—Å—Ç–∫–∞ –≤—Å–µ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
	‚Ä¢	–£–¥–∞–ª—è–µ—Ç namespace‚Äô—ã (—Å finalizer-hook –æ–±—Ä–∞–±–æ—Ç–∫–æ–π)
	‚Ä¢	–£–¥–∞–ª—è–µ—Ç ArgoCD –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
	‚Ä¢	–£–¥–∞–ª—è–µ—Ç YAML-—Ñ–∞–π–ª—ã –≤ apps/
	‚Ä¢	–°–æ–∑–¥–∞—ë—Ç –∑–∞–Ω–æ–≤–æ —Å–µ–∫—Ä–µ—Ç—ã –∏ configmap
	‚Ä¢	–û–±–Ω–æ–≤–ª—è–µ—Ç root-app

üì¶ make release VERSION=...

–°–∫–∞—á–∏–≤–∞–µ—Ç Helm-—á–∞—Ä—Ç—ã –≤ –Ω—É–∂–Ω—É—é –≤–µ—Ä—Å–∏—é –∏ —Å–æ–∑–¥–∞—ë—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É /VERSION/elma365/, /VERSION/elma365-dbs/

üìÑ make gen-apps VERSION=...

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç YAML-—Ñ–∞–π–ª—ã ArgoCD Application:
	‚Ä¢	apps/elma365-$(VERSION).yaml
	‚Ä¢	apps/elma365-dbs.yaml
–° —É—á—ë—Ç–æ–º syncWave, depends-on, valueFiles

‚úèÔ∏è make update-values

–ö–æ–º–º–∏—Ç–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ values-elma365.yaml (–µ—Å–ª–∏ –µ—Å—Ç—å) ‚Üí —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç ArgoCD sync

‚∏ª

üîê TLS –∏ CA

–°–µ–∫—Ä–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è:
	‚Ä¢	elma365-onpremise-tls ‚Äî –≤ elma365 –∏ elma365-dbs
	‚Ä¢	elma365-onpremise-ca ‚Äî –≤ elma365

–§–∞–π–ª—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ ./ssl/:
	‚Ä¢	kind.elewise.local.crt
	‚Ä¢	kind.elewise.local.key
	‚Ä¢	rootCA.pem

‚∏ª

üß† Finalizer Hook Fix

–í–Ω—É—Ç—Ä–∏ make clean-argocd –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –≤—Å–µ argocd.argoproj.io/hook-finalizer, —á—Ç–æ–±—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–¥–∞–ª—è—Ç—å namespace elma365.

## üöÄ –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

–ü—Ä–∏–º–µ—Ä –¥–ª—è –≤–µ—Ä—Å–∏–∏ `2025.4.3`:

```sh
make release-full VERSION=2025.4.3
```
ü§ù –ê–≤—Ç–æ—Ä—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–°–æ–∑–¥–∞–Ω –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å ‚ù§Ô∏è
–ö–æ–Ω—Ç–∞–∫—Ç—ã: @SimplicityOfTheGospel
